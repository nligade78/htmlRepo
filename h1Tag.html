import React, { useState } from 'react';
import {
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  Paper,
  Checkbox,
  FormControlLabel,
  Typography
} from '@mui/material';

// Sample JSON data
const jsonData = {
  "releatedProviderAdditionalDetails": {
    "confidenceScore": {
      "AZCAREPP001": {
        "POA_KEYs": [6001549220, 6001549221, 6001549222, 6001549223, 6001549224, 6001549225, 6001549226, 6001549227, 6001549228],
        "confidenceScoreOfNetwork": "94.44%",
        "countOfPOA_KEYs": 9
      },
      "AZCAREPP002": {
        "POA_KEYs": [6001549220, 6001549221, 6001549222, 6001549223, 6001549224, 6001549225, 6001549226, 6001549227, 6001549228, 6001549229, 6001549210],
        "confidenceScoreOfNetwork": "94.44%",
        "countOfPOA_KEYs": 10
      },
      "AZCAREPP003": {
        "POA_KEYs": [6001549220, 6001549221, 6001549222, 6001549223, 6001549224, 6001549225, 6001549226, 6001549227, 6001549228, 6001549229, 6001549210, 6001549211],
        "confidenceScoreOfNetwork": "94.44%",
        "countOfPOA_KEYs": 11
      }
    }
  }
};

const DynamicTable = ({ data }) => {
  const [hiddenColumns, setHiddenColumns] = useState({});

  const networks = Object.keys(data.releatedProviderAdditionalDetails.confidenceScore);
  const allPOAKeys = new Set();

  // Collect all POA_KEYs
  networks.forEach(network => {
    data.releatedProviderAdditionalDetails.confidenceScore[network].POA_KEYs.forEach(key => allPOAKeys.add(key));
  });

  const sortedPOAKeys = Array.from(allPOAKeys).sort((a, b) => a - b);

  // Check if a POA_KEY is present in all networks
  const isCommonKey = (key) => {
    return networks.every(network => data.releatedProviderAdditionalDetails.confidenceScore[network].POA_KEYs.includes(key));
  };

  // Toggle hidden columns
  const toggleColumn = (column) => {
    setHiddenColumns((prevHidden) => ({
      ...prevHidden,
      [column]: !prevHidden[column]
    }));
  };

  return (
    <>
      <div style={{ marginBottom: '20px' }}>
        {networks.map(network => (
          <FormControlLabel
            key={network}
            control={
              <Checkbox
                checked={!hiddenColumns[network]}
                onChange={() => toggleColumn(network)}
              />
            }
            label={`Show ${network}`}
          />
        ))}
      </div>

      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell><strong>POA_KEYs</strong></TableCell>
              {networks.map(network => (
                !hiddenColumns[network] && <TableCell key={network}><strong>{network}</strong></TableCell>
              ))}
              <TableCell><strong>Common POA_KEY</strong></TableCell>
              <TableCell><strong>Confidence Scores</strong></TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {sortedPOAKeys.map(key => (
              <TableRow key={key}>
                <TableCell>{key}</TableCell>
                {networks.map(network => (
                  !hiddenColumns[network] && (
                    <TableCell key={network}>
                      {data.releatedProviderAdditionalDetails.confidenceScore[network].POA_KEYs.includes(key) ? 'Y' : 'N'}
                    </TableCell>
                  )
                ))}
                <TableCell>{isCommonKey(key) ? 'Y' : 'N'}</TableCell>
                <TableCell>
                  {networks.map(network => (
                    !hiddenColumns[network] && (
                      <Typography key={`${network}-score`}>
                        {data.releatedProviderAdditionalDetails.confidenceScore[network].confidenceScoreOfNetwork}
                      </Typography>
                    )
                  ))}
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </TableContainer>
    </>
  );
};

const App = () => <DynamicTable data={jsonData} />;

export default App;
